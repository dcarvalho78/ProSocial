{% extends "base.html" %}
{% load extras %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">

    <!-- Profilkopf -->
    <div class="card card-elevated mb-4 shadow-sm">
      <div class="card-body d-flex flex-wrap align-items-center gap-3">
        {% if profile_user.profile.avatar %}
          <img src="{{ profile_user.profile.avatar.url }}" class="rounded-circle border" width="90" height="90" alt="Avatar">
        {% else %}
          <img src="https://ui-avatars.com/api/?name={{ profile_user.username|urlencode }}&background=6c757d&color=ffffff&size=90&bold=true"
               class="rounded-circle border" width="90" height="90" alt="Avatar Platzhalter">
        {% endif %}

        <div class="flex-grow-1">
          <h4 class="mb-1">{{ profile_user.username }}</h4>
          <div class="text-muted small">
            Follower:
            <span data-followers-count data-username="{{ profile_user.username }}">
              {{ followers|length }}
            </span>
            • Folgt: {{ following|length }}
          </div>

          <div class="progress mt-2" style="height: 18px;">
            <div class="progress-bar"
                 style="width: {{ profile_user.profile.reputation|default:0|floatformat:0 }}%;">
              {{ profile_user.profile.reputation|default:0|floatformat:0 }} Punkte
            </div>
          </div>

          {% if profile_user.profile.availability %}
            <span class="badge bg-success mt-2">
              <i class="bi bi-check-circle me-1"></i>Verfügbar
            </span>
          {% else %}
            <span class="badge bg-danger mt-2">
              <i class="bi bi-x-circle me-1"></i>Nicht verfügbar
            </span>
          {% endif %}
        </div>

        {% if request.user == profile_user %}
          <a href="{% url 'edit_profile' %}" class="btn btn-outline-primary">
            <i class="bi bi-pencil-square me-1"></i> Profil bearbeiten
          </a>
        {% else %}
          <button class="btn btn-outline-primary btn-sm"
                  data-action="toggle-follow"
                  data-username="{{ profile_user.username }}">
            {% if is_following %}
              <i class="bi bi-person-dash me-1"></i> Entfolgen
            {% else %}
              <i class="bi bi-person-plus me-1"></i> Folgen
            {% endif %}
          </button>
        {% endif %}
      </div>
    </div>

    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">
          <i class="bi bi-person-lines-fill me-2"></i>Über {{ profile_user.username }}
        </h5>

        {% if profile_user.profile.company %}
          <p>
            <i class="bi bi-building me-2 text-secondary"></i>
            {{ profile_user.profile.company.name }}
          </p>
        {% endif %}

        <p class="mb-3">{{ profile_user.profile.bio|default:"Keine Bio vorhanden." }}</p>

        <div class="progress mb-3" style="height: 16px;">
          <div class="progress-bar bg-success"
               role="progressbar"
               style="width: {{ profile_user.profile.reputation|floatformat:0 }}%;">
            {{ profile_user.profile.reputation|floatformat:0 }} Punkte
          </div>
        </div>

        <h6 class="text-uppercase text-muted mt-4 mb-2">Fähigkeiten</h6>
        {% if profile_user.profile.skills.all %}
          <div class="d-flex flex-wrap gap-2">
            {% for skill in profile_user.profile.skills.all %}
              <span class="badge bg-primary-subtle text-primary border">{{ skill.name }}</span>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted small">Keine Fähigkeiten angegeben.</p>
        {% endif %}
      </div>
    </div>

    <div class="card shadow-sm mb-5">
      <div class="card-body text-center text-muted py-5">
        <i class="bi bi-images fs-3 d-block mb-2"></i>
        <hr>
        <h4 class="mt-4">Portfolio</h4>

        <a href="{% url 'project_create' %}" class="btn btn-sm btn-outline-success mb-3">
          <i class="bi bi-plus-circle me-1"></i> Neues Projekt
        </a>

        <div class="row">
          {% for project in profile_user.profile.projects.all %}
            <div class="col-md-4 mb-3">
              <div class="card h-100">
                {% if project.image %}
                  <img src="{{ project.image.url }}" class="card-img-top" alt="{{ project.title }}">
                {% endif %}
                <div class="card-body">
                  <h5 class="card-title">{{ project.title }}</h5>
                  <p class="card-text small text-muted">{{ project.description|truncatewords:20 }}</p>
                  {% if project.url %}
                    <a href="{{ project.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-link-45deg"></i> Website
                    </a>
                  {% endif %}
                </div>
                <div class="card-footer small text-muted">
                  {% for skill in project.skills.all %}
                    <span class="badge bg-secondary">{{ skill.name }}</span>
                  {% empty %}
                    <span class="text-muted">Keine Skills angegeben</span>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% empty %}
            <p class="text-muted">Noch keine Projekte vorhanden.</p>
          {% endfor %}
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
